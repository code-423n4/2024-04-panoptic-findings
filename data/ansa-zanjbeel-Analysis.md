# **Panoptic Analysis Report**

## **Overview**

- Panoptic is a Permissionless Options Trading Protocol.
- It Enables The Trading of Perpetual Options On Top of Any Uniswap V3 Pool.
- the Panoptic Protocol is Noncustodial, Has No Counterparty Risk, Offers Instantaneous Settlement.
- This is Designed To Remain Fully Collateralized at All Times.

## **Core Contracts**

### **SemiFungiblePositionManager(SFPM)**

- A Gas-Efficient Alternative to `Uniswap’s NonFungiblePositionManager` That Manages Complex, Multi-Leg Uniswap Positions Encoded in ERC1155 TokenIds.

- Performs Swaps Allowing Users to Mint Positions with Only One Type of Token.

- Most Significant, It Supports the Minting of Both Typical LP Positions `Where Liquidity is Added` to Uniswap & Long Positions `Where Uniswap Liquidity is Burnt`.

- While the SFPM is Consider as a Core Component of the Protocol & That is Consider to Be the `Engine of Panoptic`.

- It is Also a Public Good, Savvy Uniswap V3 LPs Will Grow to Find an Essential Tool and Upgrade for Managing Their Liquidity.

#

### **Collateral Tracker**

- An ERC4626 Vault Where Token Liquidity From Passive `Panoptic Liquidity Providers(PLPs)` & Collateral for Option Positions are Deposited.

- Collateral Trackers are Also Responsible For Paying Out Commission Fees & Options Premia.

- Also Handles Payments Of Intrinsic Value For Options & Distributing P&L, Calculating Liquidation Bonuses, & Determining Costs For Forcefully Exercising Another User’s Options.

- However, The Most Important Functionality Of The CollateralTracker is To Calculate the Collateral Requirement For Every Account & Position.

- Each Time Positions are Minted/Burned in Panoptic, The CollateralTracker Updates the Collateral Balances & Provides Information On The Collateral Requirement, Ensuring That The Protocol Remains Solvent & So Retain the Ability to Liquidate Distressed Positions When Needed.

#

### **Panoptic Pool**

- The Panoptic Pool Exposes the Core Functionality of the Protocol.

- If the `SFPM` is the `Engine of Panoptic`

- Then `Panoptic Pool is Conductor`

- This contract `Acts as The Base` For All Interactions With The Protocol, Such as Minting/Burning Positions, Liquidating/Force Exercising Distressed Accounts, or Just Checking Position Balances and Accumulating Premiums, Originate in This Contract.

- It is `Responsible For Making Required Calls` To The SFPM to Actually Create Option Positions in Uniswap, Tracking User Balances, Accumulating Premia on Those Positions, & Calling the CollateralTracker With the Data It Needs to Settle Position Changes.

`

## **Architecture**

Each Instance of the Panoptic Protocol on a Uniswap Pool Contains:

- One PanopticPool That Orchestrates All Interactions in the Protocol
- Two CollateralTrackers, One for Each Constituent Token0/token1 in the Uniswap Pool
- Canonical SFPM - the SFPM Manages Liquidity across Every Panoptic Pool

## **Actors**

There are Five Primary Roles Assumed by Actors in This Panoptic Ecosystem:

 **`Panoptic Liquidity Providers (PLPs)`**

Users Who Deposit Tokens into One or Both CollateralTracker Vaults. The Liquidity Deposited by These Users is Borrowed by Option Sellers to Create Their Positions - Their Liquidity is What Enables Undercollateralized Positions. In Return, They Receive Commission Fees on Both the Notional and Intrinsic Values of Option Positions When They are Minted.

Note That Options Buyers and Sellers are PLPs Too - They Must Deposit Collateral to Open Their Positions. We Consider Users Who Deposit Collateral but Do Not Trade on Panoptic To be Passive PLPs.

#

**`Option Sellers`**

These Users Deposit Liquidity into the Uniswap Pool Through Panoptic, Making It Available For Options Buyers to Remove. This Role is Similar to Providing Liquidity Directly to Uniswap V3, but Offers Many Benefits Including Advanced Tools to Manage Risky, Complex Positions and a Multiplier on the Fees/premia Generated by Their Liquidity When It is Removed by Option Buyers. Sold Option Positions on Panoptic Have Similar Payoffs to Traditional Options.

#

**`Option Buyers`**

These Users Remove Liquidity Added by Option Sellers from Uniswap Pool and Move Tokens Back into Panoptic. The Premia They Pay to Sellers for the Privilege is Equivalent to the Fees That Would Have Been Generated by the Removed Liquidity, plus a Spread Multiplier Based on the Portion of Available Liquidity in Their Uniswap Liquidity Chunk That Has Been Removed or Utilized.

#

**`Liquidators`**

These Users are Responsible for Liquidating Distressed Accounts That No Longer Meet the Collateral Requirements Needed to Maintain Their Positions. They Provide the Tokens Necessary to Close All Positions in the Distressed Account and Receive a Bonus from the Remaining Collateral. Sometimes, They May Also Need to Buy or Sell Options to Allow Lower Liquidity Positions to Be Exercised.

#

**`Force Exercisors`**

These are Usually Options Sellers. They Provide the Required Tokens and Forcefully Exercise Long Positions (from Option Buyers) in Out-Of-Range Strikes That are No Longer Generating Premia, So the Liquidity from Those Positions is Added Back to Uniswap and the Sellers Can Exercise Their Positions (which Involves Burning That Liquidity). They Pay a Fee to the Exercised User for the Inconvenience.

## **Panoptic Contracts Analyis (InScope)**



| List | Contract                                      | nSLOC | Purpose                                                                                                                                                                                |
| :--- | :-------------------------------------------- | :---- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | contracts/CollateralTracker.sol               | 792   | ERC4626 vault where token liquidity from Panoptic Liquidity Providers (PLPs) and collateral for option positions are deposited and collateral requirements are computed                |
| 2    | contracts/PanopticFactory.sol                 | 249   | Handles deployment of new Panoptic instances on top of Uniswap pools, initial liquidity deployments, and NFT rewards for deployers                                                     |
| 3    | contracts/PanopticPool.sol                    | 1162  | Coordinates all options trading activity - minting, burning, force exercises, liquidations                                                                                             |
| 4    | contracts/SemiFungiblePositionManager.sol     | 724   | The 'engine' of Panoptic - manages all Uniswap V3 positions in the protocol as well as being a more advanced, gas-efficient alternative to NFPM for Uniswap LPs                        |
| 5    | contracts/libraries/CallbackLib.sol           | 22    | Library for verifying and decoding Uniswap callbacks"                                                                                                                                  |
| 6    | contracts/libraries/Constants.sol             | 9     | Library of Constants used in Panoptic                                                                                                                                                  |
| 7    | contracts/libraries/Errors.sol                | 35    | Contains all custom errors used in Panoptic's core contracts                                                                                                                           |
| 8    | contracts/libraries/FeesCalc.sol              | 86    | Utility to calculate up-to-date swap fees for liquidity chunks                                                                                                                         |
| 9    | contracts/libraries/InteractionHelper.sol     | 72    | Helpers to perform bytecode-size-heavy interactions with external contracts like batch approvals and metadata queries                                                                  |
| 10   | contracts/libraries/Math.sol                  | 417   | Library of generic math functions like abs(), mulDiv, etc                                                                                                                              |
| 11   | contracts/libraries/PanopticMath.sol          | 573   | Library containing advanced Panoptic/Uniswap-specific functionality such as our TWAP, price conversions, and position sizing math                                                      |
| 12   | contracts/libraries/SafeTransferLib.sol       | 33    | Safe ERC20 transfer library that gracefully handles missing return values"                                                                                                             |
| 13   | contracts/multicall/Multicall.sol             | 18    | Adds a function to inheriting contracts that allows for multiple calls to be executed in a single transaction"                                                                         |
|  |
| 14   | contracts/tokens/ERC1155Minimal.sol           | 115   | A minimalist implementation of the ERC1155 token standard without metadata                                                                                                             |
| 15   | contracts/tokens/ERC20Minimal.sol             | 52    | A minimalist implementation of the ERC20 token standard without metadata                                                                                                               |
| 16   | contracts/tokens/interfaces/IDonorNFT.sol     | 4     | An interface the PanopticFactory can use to issue reward NFTs                                                                                                                          |
| 17   | contracts/tokens/interfaces/IERC20Partial.sol | 6     | An incomplete ERC20 interface containing functions used in Panoptic with some return values omitted to support noncompliant tokens such as USDT                                        |
| 18   | contracts/types/LeftRight.sol                 | 156   | Implementation for a set of custom data types that can hold two 128-bit numbers                                                                                                        |
| 19   | contracts/types/LiquidityChunk.sol            | 91    | Implementation for a custom data type that can represent a liquidity chunk of a given size in Uniswap - containing a tickLower, tickUpper, and liquidity                               |
| 20   | contracts/types/TokenId.sol                   | 305   | "Implementation for the custom data type used in the SFPM and Panoptic to encode position data in 256-bit ERC1155 tokenIds - holds a pool identifier and up to four full position legs |



# Risk Factor Analysis


- `Admin Abuse Risks`

I Dont Think so That This Protocol Has Any Admin Related Risk as This Protocol is Noncustodial, & Has No Counterparty Risk.

- `Systemic Risks`

The Protocol's System Works Well since Reentrancy Lock is Implemented & There is No Significant Risk of Calculation, but There is Always the Possibility of Human Error, So We Should Manage Position Data & Fee Calculations Carefully to Prevent the Integrity of the Protocol as It Might Lead to a Big Trouble.


- `Technical Risks`

There May Arise Some Techinical Risks, as Those Resulting from Exceeded Gas Restrictions or the Fact That the Protocol Depends on Other External Contracts, Means That Any Bugs Introduces There Could Potentially Affect This Protocol.

- `Integration Risks`

 There May Occur Some Integration Risks as Contract Integrates with External Contracts & Libraries. Any Problems with the Integration Procedure Could Result in Unexpected Behavior.

 - `Non-Standard Token Risks`

  Risks Related to Non-Standard Behavior May Arise If Tokens Do Not Implement the Standard Properly Also by Handling Token Transfers and Positions Introduces Risks of Token Manipulation or Unauthorized Transfers If Proper Controls are Not Enforced.



##






### Time spent:
15 hours